<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>WEdPad - Web: Elite Dangerous Pad</title>
    <link rel="stylesheet" href="wedpad.css">
</head>

<body>

<div id="left">
    <div class="view-top"    id="view-top"></div>
    <div class="view-main"   id="view-log"></div>
    <div class="view-main"   id="view-system"></div>
    <div class="view-main"   id="view-bodies"></div>
    <div class="view-main"   id="view-signals"></div>
    <div class="view-bottom" id="view-bottom"></div>
</div>

<div id="right">
    <div class="button" id="button-log" onClick="switchView('log');"><b>LOG</b><span id="button-log-text"></span></div>
    <div class="button" id="button-system" onClick="switchView('system');"><b>SYSTEM</b><span id="button-system-text"></span></div>
    <div class="button" id="button-bodies" onClick="switchView('bodies');"><b>BODIES</b><span id="button-bodies-text"></span></div>
    <div class="button" id="button-signals" onClick="switchView('signals');"><b>SIGNALS</b><span id="button-signals-text"></span></div>
</div>

<!-- SCRIPTS -->

<script>

window.onload = function () {
    switchView("log");
};

function switchView(id) {
    document.getElementById("button-log").setAttribute("class", "button");
    document.getElementById("button-system").setAttribute("class", "button");
    document.getElementById("button-bodies").setAttribute("class", "button");
    document.getElementById("button-signals").setAttribute("class", "button");
    document.getElementById("button-" + id).setAttribute("class", "button button-active");

    document.getElementById("view-log").style.display = 'none';
    document.getElementById("view-system").style.display = 'none';
    document.getElementById("view-bodies").style.display = 'none';
    document.getElementById("view-signals").style.display = 'none';
    document.getElementById("view-" + id).style.display = 'block';
};

var logView = document.getElementById("view-log");

var wsUrl = "ws://" + window.location.hostname + ":" + window.location.port + "/ws";
var socket = new WebSocket(wsUrl);

socket.onopen = function() {
    logView.innerHTML = "<h1>CONNECTED!</h1>";
    socket.send("connected");
};

socket.onmessage = function(msg) {

    const obj = JSON.parse(msg.data);

    var action = obj.Action;
    var target = obj.Target;
    var otype = obj.Type;
    var data = obj.Data;
    var output;

    if (otype === "view") {
        output = document.getElementById("view-" + target);
    } else if (otype === "button") {
        output = document.getElementById("button-" + target + "-text");
    }

    if (action === "replace") {
            output.innerHTML = data;
    } else if (action === "append") {
            output.innerHTML += data;
    } else if (action === "clean") {
            output.innerHTML = "";
    } else if (action === "attention") {
        if (otype === "button") {
            document.getElementById(otype + "-" + target).setAttribute("class", "button button-attention");
        } else if (otype === "view") {
            switchView(target)
        }
    }

    socket.send("ack");

    <!-- target.scrollBy(0, 500); -->

};

socket.onclose = function(ev) {
    logView.innerHTML += "<p><b>CONNECTION CLOSED: " + "Clean:" + ev.wasClean + " Reason:" + ev.reason + " Code:" + ev.code + "</b>";
    switchView("log");
    socket.send("closed");
};

</script>


</body>

</html>
